<% suspicious_users = User.suspicious.includes(:connected_accounts).order(suspicion_marked_at: :desc).limit(50) %>

<div class="p-4 overflow-y-auto h-full">
  <% if suspicious_users.empty? %>
    <p class="text-gray-500 text-center py-8">No suspicious users found.</p>
  <% else %>
    <table class="min-w-full divide-y divide-gray-200">
      <thead>
        <tr>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">User</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Signals</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Flagged</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% suspicious_users.each do |user| %>
          <tr>
            <td class="px-3 py-2 text-sm">
              <%= link_to user.name, avo.resources_user_path(user), class: "text-blue-600 hover:underline", data: { turbo_frame: "_top" } %>
              <% if user.github_handle.present? %>
                <br><span class="text-gray-400 text-xs">@<%= user.github_handle %></span>
              <% end %>
            </td>
            <td class="px-3 py-2 text-sm">
              <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= user.suspicion_detector.signal_count >= 4 ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800' %>">
                <%= user.suspicion_detector.signal_count %> / 5
              </span>
            </td>
            <td class="px-3 py-2 text-sm text-gray-500">
              <%= time_ago_in_words(user.suspicion_marked_at) %> ago
            </td>
            <td class="px-3 py-2 text-sm space-x-2">
              <%= link_to "View", avo.resources_user_path(user), class: "text-blue-600 hover:underline text-xs", data: { turbo_frame: "_top" } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>
