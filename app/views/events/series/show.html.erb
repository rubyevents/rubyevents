<%= turbo_refreshes_with method: :morph, scroll: :preserve %>

<div class="container py-8">
  <div class="block lg:flex gap-8 align-center justify-between">
    <div class="flex flex-col lg:flex-row gap-8 items-center lg:justify-right text-center lg:text-left mb-6 lg:mb-0">
      <% if @events.first&.avatar_image_path %>
        <%= image_tag image_path(@events.first&.avatar_image_path),
              class: "rounded-full border border-[#D9DFE3] size-24 md:size-36",
              alt: "#{@event_series.name} Avatar",
              loading: :lazy %>
      <% end %>

      <div class="flex-col flex justify-center">
        <h1 class="mb-2 text-black font-bold"><%= @event_series.name %></h1>
        <h3 class="hidden md:block text-[#636B74]"><%= pluralize(@event_series.events.count, "event") %>
          <% if @event_series.youtube_channel_name.present? %>
            - @<%= @event_series.youtube_channel_name %>
          <% end %>
        </h3>
      </div>
    </div>

    <% if Current.user&.admin? %>
      <div class="flex flex-col gap-2">
        <%= ui_button url: reimport_series_path(@event_series), method: :post, kind: :neutral, size: :sm, class: "w-full" do %>
          Reimport Series
        <% end %>
        <%= ui_button url: avo.resources_event_series_path(@event_series), target: :_blank, kind: :neutral, size: :sm, class: "w-full" do %>
          Open in Avo
        <% end %>
      </div>
    <% end %>
  </div>

  <p class="mt-3 md:mt-9 mb-3 text-[#636B74] max-w-[700px]">
    <%= @event_series.description %>
  </p>

  <% if @event_series.static_metadata&.ended? %>
    <div class="flex -mt-0.5 mb-4 text-gray-400">
      <%= fa "box-archive", size: :xs, class: "mt-0.5 fill-gray-400" %>
      <span class="text-sm mt-0.5 ml-0.5">This event series is not active anymore.</span>
    </div>
  <% end %>

  <% if (featured_event = @events.find { |event| event.featurable? }) %>
    <div class="hidden lg:block">
      <%= render partial: "events/featured", locals: {event: featured_event} %>
    </div>
  <% end %>

  <% if @events.any? %>
    <div id="events" class="mt-12">
      <section class="flex flex-col w-full gap-4">
        <div class="flex items-center justify-between w-full">
          <h2 class="text-primary shrink-0">Events</h2>
        </div>
        <div class="grid min-w-full grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-3 md:[&>:nth-child(4)]:hidden lg:grid-cols-4 lg:[&>:nth-child(4)]:block">
          <%= cache @events do %>
            <%= render partial: "events/card", collection: @events, as: :event, cached: true %>
          <% end %>
        </div>
      </section>
    </div>
  <% end %>
</div>
