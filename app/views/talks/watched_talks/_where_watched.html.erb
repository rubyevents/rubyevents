<%# locals: (talk:, watched_talk:) %>

<% update_path = talk_watched_talk_path(talk) %>

<div>
  <label class="text-sm font-medium text-gray-700 mb-3 block">Where did you watch?</label>

  <div class="grid grid-cols-2 sm:grid-cols-5 gap-2 auto-rows-fr">
    <% WatchedTalk.watched_on_options_for(talk).each do |key, option| %>
      <% selected = watched_talk.watched_on == key %>
      <% watched_at = (key == "in_person" && talk.date) ? talk.date.to_date : nil %>

      <%= button_to update_path, method: :patch, class: "contents", params: {watched_talk: {watched_on: key, watched_at: watched_at}.compact} do %>
        <div class="flex flex-col items-center justify-center p-3 border-2 rounded-lg cursor-pointer transition-colors h-full <%= selected ? "border-red-500 bg-red-500 text-white hover:bg-red-600" : "bg-white hover:bg-gray-50" %>">
          <%= fa(option[:icon], size: :lg, class: class_names("mb-1", "fill-white": selected)) %>
          <span class="text-xs text-center leading-tight"><%= option[:label] %></span>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
