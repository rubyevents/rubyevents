<%
  video_provider = case @talk.video_provider
  when "mp4" then "mp4"
  when "parent" then @talk.parent_talk.video_provider
  else @talk.video_provider
  end

  video_provider = @talk.video_provider if @talk.parent_talk&.video_provider == "children"
  video_id = (@talk.video_provider == "parent") ? @talk.parent_talk.video_id : @talk.video_id
%>

<%= turbo_stream.update dom_id(@talk, :video_player) do %>
  <%= render partial: "talks/video_player", locals: {talk: @talk, current_user_watched_talk: nil, is_watched: false, video_provider: video_provider, video_id: video_id} %>
<% end %>

<%= turbo_stream.update dom_id(@talk, :feedback_banner) do %>
<% end %>

<%= turbo_stream.update dom_id(@talk, :watched_button) do %>
  <%= render partial: "talks/watched_talks/button", locals: {talk: @talk, is_watched: false} %>
<% end %>

<%= turbo_stream.update dom_id(@talk, :player_actions) do %>
  <%= render partial: "talks/player_action_buttons", locals: {talk: @talk, is_watched: false} %>
<% end %>

<%= turbo_stream.replace dom_id(@talk, :watched_control) do %>
  <span id="<%= dom_id(@talk, :watched_control) %>" style="display: contents;">
    <% if @talk.date.blank? || @talk.date <= Date.current %>
      <%= link_to new_talk_watched_talk_path(@talk), data: {turbo_frame: "modal"}, class: "custom-player-btn", "data-tooltip": "Mark as Watched" do %>
        <%= fa("circle-check", size: :lg, style: :regular, class: "fill-white") %>
      <% end %>
    <% end %>
  </span>
<% end %>
