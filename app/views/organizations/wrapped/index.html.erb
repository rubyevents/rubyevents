<% content_for :head do %>
  <title><%= @organization.name %> <%= @year %> Wrapped - RubyEvents.org</title>
  <% og_stats = [] %>
  <% og_stats << "#{@total_events_sponsored} events sponsored" if @total_events_sponsored.positive? %>
  <% og_stats << "#{@talks_at_sponsored_events} talks supported" if @talks_at_sponsored_events.positive? %>
  <% og_stats << "#{@speakers_at_sponsored_events} speakers supported" if @speakers_at_sponsored_events.positive? %>
  <% og_stats << "#{@countries_sponsored.count} countries reached" if @countries_sponsored.any? %>
  <% og_description = og_stats.any? ? "#{@organization.name}'s #{@year}: #{og_stats.join(" ¬∑ ")}. See the full Wrapped!" : "See #{@organization.name}'s #{@year} Ruby Events Wrapped!" %>

  <meta name="description" content="<%= og_description %>">
  <meta property="og:title" content="<%= @organization.name %>'s <%= @year %> Wrapped - RubyEvents.org">
  <meta property="og:description" content="<%= og_description %>">
  <meta property="og:image" content="<%= og_image_organization_wrapped_index_url(organization_slug: @organization.slug) %>">
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= organization_wrapped_index_url(organization_slug: @organization.slug) %>">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= @organization.name %>'s <%= @year %> Wrapped - RubyEvents.org">
  <meta name="twitter:description" content="<%= og_description %>">
  <meta name="twitter:image" content="<%= og_image_organization_wrapped_index_url(organization_slug: @organization.slug) %>">
<% end %>

<div class="min-h-screen bg-[linear-gradient(to_bottom,#991b1b_0%,#450a0a_30%,#081625_70%,#081625_100%)]">
  <div class="max-w-4xl mx-auto px-4 py-12">
    <div class="text-center text-white mb-12">
      <% if @organization.logo_url.present? %>
        <%= link_to organization_path(@organization), class: "block w-24 h-24 mx-auto mb-4 rounded-xl overflow-hidden bg-white p-2 hover:scale-105 transition" do %>
          <%= image_tag @organization.logo_url, class: "w-full h-full object-contain", alt: @organization.name %>
        <% end %>
      <% end %>

      <%= link_to organization_path(@organization), class: "text-lg text-red-300 hover:text-white transition" do %>
        <%= @organization.name %>
      <% end %>
      <p class="text-red-300/60 text-sm mt-1" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">RubyEvents.org</p>
      <h1 class="text-6xl font-black text-white mt-2" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;"><%= @year %></h1>
      <p class="text-3xl font-bold text-red-200 mt-1" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">Wrapped</p>
      <p class="text-xl text-red-100 max-w-lg mx-auto mt-6">
        <% if @years_supporting > 1 %>
          <%= @years_supporting %> years of supporting the Ruby community
        <% else %>
          A year of supporting the Ruby community
        <% end %>
      </p>
    </div>

    <% if @total_events_sponsored.positive? %>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white/10 backdrop-blur rounded-xl p-6 text-center">
          <p class="text-4xl font-black text-white"><%= @total_events_sponsored %></p>
          <p class="text-red-200 text-sm mt-1">Events Supported</p>
        </div>
        <div class="bg-white/10 backdrop-blur rounded-xl p-6 text-center">
          <p class="text-4xl font-black text-white"><%= number_with_delimiter(@talks_at_sponsored_events) %></p>
          <p class="text-red-200 text-sm mt-1">Talks Supported</p>
        </div>
        <div class="bg-white/10 backdrop-blur rounded-xl p-6 text-center">
          <p class="text-4xl font-black text-white"><%= number_with_delimiter(@speakers_at_sponsored_events) %></p>
          <p class="text-red-200 text-sm mt-1">Speakers Supported</p>
        </div>
        <div class="bg-white/10 backdrop-blur rounded-xl p-6 text-center">
          <p class="text-4xl font-black text-white"><%= @countries_sponsored.count %></p>
          <p class="text-red-200 text-sm mt-1">Countries Reached</p>
        </div>
      </div>

      <div class="bg-white/10 backdrop-blur rounded-xl p-6 mb-8">
        <h3 class="text-lg font-bold text-white mb-4">üé™ Events Supported</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          <% @sponsored_events.each do |event| %>
            <%= link_to event_path(event), class: "group" do %>
              <div class="aspect-video rounded-lg overflow-hidden mb-2">
                <%= image_tag event.card_image_path, class: "w-full h-full object-cover group-hover:scale-105 transition", alt: event.name %>
              </div>
              <p class="text-white font-medium text-sm group-hover:text-red-200 transition truncate"><%= event.name %></p>
              <p class="text-red-300 text-xs">
                <%= event.start_date&.strftime("%B") %>
                <% if event.country.present? %>
                  ¬∑ <%= event.country.emoji_flag %>
                <% end %>
              </p>
            <% end %>
          <% end %>
        </div>
      </div>

      <% if @sponsor_tiers.any? %>
        <div class="bg-white/10 backdrop-blur rounded-xl p-6 mb-8">
          <h3 class="text-lg font-bold text-white mb-4">üèÜ Sponsorship Tiers</h3>
          <div class="flex flex-wrap gap-3">
            <% @sponsor_tiers.each do |tier, count| %>
              <span class="inline-flex items-center gap-2 px-4 py-2 bg-white/10 rounded-full text-white">
                <span class="font-medium capitalize"><%= tier %></span>
                <span class="text-red-300"><%= count %></span>
              </span>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if @countries_sponsored.any? %>
        <div class="bg-white/10 backdrop-blur rounded-xl p-6 mb-8">
          <h3 class="text-lg font-bold text-white mb-4">üåç Global Reach</h3>
          <div class="flex flex-wrap gap-2">
            <% @countries_sponsored.sort_by { |c| c.translations["en"] }.each do |country| %>
              <%= link_to country_path(country: country.alpha2.downcase), class: "inline-flex items-center gap-1 px-3 py-1 bg-white/10 rounded-full text-sm text-white hover:bg-white/20 transition" do %>
                <%= country.emoji_flag %> <%= country.translations["en"] %>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="bg-white/10 backdrop-blur rounded-xl p-8 text-center">
        <p class="text-red-200">No sponsorship data for <%= @year %> yet.</p>
      </div>
    <% end %>

    <% if @involvements.any? %>
      <div class="bg-white/10 backdrop-blur rounded-xl p-6 mb-8">
        <h3 class="text-lg font-bold text-white mb-4">ü§ù Community Involvement</h3>
        <div class="space-y-4">
          <% @involvements_by_role.each do |role, involvements| %>
            <div>
              <p class="text-red-300 text-sm font-medium mb-2 capitalize"><%= role %></p>
              <div class="flex flex-wrap gap-2">
                <% involvements.each do |involvement| %>
                  <%= link_to event_path(involvement.event), class: "inline-flex items-center px-3 py-1 bg-white/10 rounded-full text-sm text-white hover:bg-white/20 transition" do %>
                    <%= involvement.event.name %>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <div class="bg-white/10 backdrop-blur rounded-xl p-6 text-center">
      <h3 class="text-lg font-bold text-white mb-4">Share Your Impact</h3>
      <div class="space-y-3 max-w-xs mx-auto">
        <%= link_to og_image_organization_wrapped_index_path(organization_slug: @organization.slug, download: 1),
              data: {turbo: false},
              class: "flex items-center justify-center gap-3 w-full p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition cursor-pointer" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
          <span class="font-medium">Download Summary Card</span>
        <% end %>

        <div data-controller="copy-to-clipboard" data-copy-to-clipboard-success-message-value="‚úì Copied!">
          <span data-copy-to-clipboard-target="source" class="hidden"><%= @share_url %></span>
          <button data-action="copy-to-clipboard#copy" data-copy-to-clipboard-target="button" class="flex items-center justify-center gap-3 w-full p-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
            <span class="font-medium">Copy Link</span>
          </button>
        </div>
      </div>
    </div>

    <div class="text-center mt-8">
      <p class="text-red-200 text-sm mb-4">
        Thank you for supporting the Ruby community! üíé
      </p>
      <%= link_to wrapped_path, class: "inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-full font-medium transition" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
        View Your <%= @year %> Wrapped
      <% end %>
    </div>
  </div>
</div>
