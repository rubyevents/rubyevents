<% content_for :head do %>
  <!-- TODO ADD Rubyevents webcomponents script here -->
<% end %>

<div class="container my-8">
  <div class="max-w-3xl mx-auto">
    <div class="mb-8">
      <%= link_to "← Back to Announcements", announcements_path(**permitted_params), class: "text-primary hover:underline" %>
    </div>

    <article>
      <header class="mb-8">
        <h1 class="text-4xl font-bold text-primary mb-4"><%= @announcement.title %></h1>

        <div class="flex flex-wrap items-center gap-4 text-gray-500">
          <time datetime="<%= @announcement.date.iso8601 %>"><%= I18n.l(@announcement.date, default: "") %></time>

          <% if @announcement.author_user %>
            <div class="flex items-center gap-2">
              <span>By</span>
              <%= link_to profile_path(@announcement.author_user), class: "flex items-center gap-2 hover:underline" do %>
                <% if @announcement.author_user.github_handle.present? %>
                  <%= ui_avatar(@announcement.author_user, size: :xs) %>
                <% end %>
                <span>@<%= @announcement.author %></span>
              <% end %>
            </div>
          <% elsif @announcement.author.present? %>
            <div>By <%= @announcement.author %></div>
          <% end %>
        </div>

        <% if @announcement.tags.any? %>
          <div class="flex flex-wrap gap-2 mt-4">
            <% @announcement.tags.each do |tag| %>
              <%= link_to announcements_path(tag: tag, **permitted_params), class: "badge badge-ghost hover:badge-primary px-2 py-3 text-xs transition-colors" do %>
                <%= tag %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </header>

      <% if @announcement.featured_image.present? %>
        <div class="mb-8">
          <%= image_tag @announcement.featured_image, class: "w-full rounded-lg", alt: @announcement.title %>
        </div>
      <% end %>

      <div class="markdown prose max-w-none">
        <%= announcement_markdown_to_html(@announcement.content) %>
      </div>
    </article>

    <div class="mt-12 pt-8 border-t border-base-200">
      <%= link_to "← Back to Announcements", announcements_path(**permitted_params), class: "text-primary hover:underline" %>
    </div>
  </div>
</div>
