<%# locals: (user:) %>

<div class="absolute left-1/2 -translate-x-1/2 bottom-full mb-1 w-80 rounded-2xl opacity-0 group-hover/card:opacity-100 transition-opacity duration-200 pointer-events-none group-hover/card:pointer-events-auto z-20 shadow-2xl bg-white border border-gray-200" data-hover-card-target="card">
  <div class="absolute -bottom-2 left-0 right-0 h-3"></div>

  <div class="p-5">
    <div class="flex items-start gap-3">
      <%= ui_avatar(user, size: :sm) %>

      <div class="min-w-0 flex-1">
        <%= link_to profile_path(user), class: "font-bold text-gray-900 leading-tight line-clamp-1 flex items-center gap-1.5 hover:underline" do %>
          <span class="truncate"><%= user.name %></span>

          <% if user.verified? %>
            <%= fa("badge-check", class: "fill-blue-500 shrink-0", size: :xs) %>
          <% end %>

          <% if user.passports.any? %>
            <%= fa("passport", class: "fill-orange-800 shrink-0", size: :xs) %>
          <% end %>
        <% end %>

        <div class="text-sm text-gray-500 truncate">
          <% if user.github_handle.present? %>
            @<%= user.github_handle %>
          <% elsif user.bsky.present? %>
            @<%= user.bsky %>
          <% else %>
            @<%= user.slug %>
          <% end %>
        </div>

        <% if user.location_info&.geocoded? %>
          <div class="flex items-center gap-1 text-xs text-gray-500 mt-1">
            <%= fa "location-dot", size: :xs, class: "text-gray-400" %>
            <%= render "shared/location", location_info: user.location_info %>
          </div>
        <% elsif user.location.present? %>
          <div class="flex items-center gap-1 text-xs text-gray-500 mt-1">
            <%= fa "location-dot", size: :xs, class: "text-gray-400" %>
            <span class="truncate"><%= user.location %></span>
          </div>
        <% end %>
      </div>
    </div>

    <% if user.bio.present? %>
      <p class="text-xs text-gray-600 mt-3 line-clamp-2"><%= user.bio %></p>
    <% end %>

    <% if user.talks_count > 0 || user.events.any? %>
      <div class="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between">
        <div class="flex items-center gap-3 text-xs text-gray-500">
          <% if user.talks_count > 0 %>
            <span class="flex items-center gap-1">
              <%= fa "video", size: :xs, class: "text-gray-400" %>
              <%= pluralize(user.talks_count, "talk") %>
            </span>
          <% elsif user.events.any? %>
            <span class="flex items-center gap-1">
              <%= fa "calendar", size: :xs, class: "text-gray-400" %>
              <%= pluralize(user.events.count, "event") %> attended
            </span>
          <% end %>
        </div>

        <% if user.events.any? %>
          <div class="flex -space-x-1">
            <% user.events.limit(3).each do |event| %>
              <% if event.avatar_image_path %>
                <%= link_to event_path(event), class: "block w-5 h-5 rounded overflow-hidden ring-2 ring-white hover:ring-primary transition-all", data: {controller: "tooltip", tooltip_content_value: event.name} do %>
                  <%= image_tag event.avatar_image_path, alt: event.name, class: "w-full h-full object-cover", loading: "lazy" %>
                <% end %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
